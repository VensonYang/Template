<!doctype html>
<html ng-app="" lang="zh-CN">
<head>
	<meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>海北小学题库管理系统</title>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/style.css">
<!--[if lt IE 9]>
      <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>
<body>
	 <div class="a-body r-body">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12 col-md-12 col-lg-12 a-r">
                    <div class="row">
                        <div class="col-md-12 col-lg-12 col-sm-12">
                            <div class="panel query">
                                <div class="panel-heading">
                                    <h3>查询条件</h3>
                                </div>
                                <div class="panel-body">
                                    <form class="form-inline">
                                        <div class="row">
                                            <div class="col-md-4 col-lg-3 col-sm-6 col-xs-6">
                                                <div class="row">
                                                    <div class="form-group col-md-3 col-lg-3 col-sm-3 col-xs-3">
                                                        <label>帐号：</label>
                                                    </div>
                                                    <div class="form-group col-md-9 col-lg-9 col-sm-9 col-xs-9">
                                                        <input id="searchAccount" class="form-control" type="text" name="account">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-lg-3 col-sm-6 col-xs-6">
                                                <div class="row">
                                                    <div class="form-group col-md-3 col-lg-3 col-sm-3 col-xs-3">
                                                        <label>姓名：</label>
                                                    </div>
                                                    <div class="form-group col-md-9 col-lg-9 col-sm-9 col-xs-9">
                                                         <input id="searchName" type="text" class="form-control" name="name">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-lg-3 col-sm-6 col-xs-6">
                                                <div class="row">
                                                    <div class="form-group col-md-3 col-lg-3 col-sm-3 col-xs-3">
                                                        <label>状态：</label>
                                                    </div>
                                                    <div class="form-group col-md-9 col-lg-9 col-sm-9 col-xs-9">
                                                        <select id="searchStatus" class="form-control" name="status">
	                                                    	<option value="" >状态</option>
	                                                        <option value="1">启用</option>
	                                                        <option value="0">停用</option>
	                                                    </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-lg-3 col-sm-6 col-xs-6">
                                                <div class="row">
                                                    <div class="col-md-3 col-lg-3 col-sm-3 col-xs-3"></div>
                                                    <input onclick="onSearch()" type="button" value="查询" class="btn-1 btn-search">
                                                    <input type="button" value="清空" class="btn-1 btn-clear">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row a-r-b">
                        <div class="col-md-12 col-lg-12 col-sm-12">
                            <div class="panel">
                                <div class="panel-heading clearfix">
                                    <h3>用户管理</h3>
                                </div>
                                <div class="tool-bar">
                                    <ul class="tool-list clearfix">
                                        <li class="tool-list-item">
                                            <label>全选/反选</label>
                                        </li>
                                         <li class="tool-list-item" onclick="add()"><a class="add" data-toggle='modal' data-backdrop="static" data-target="#modify-user">增加</a></li>
                                        <li class="tool-list-item" onclick="deleteObject('userManage/deleteUser','#table')"><span class="delete">删除</span></li>
                                    </ul>
                                </div>
                                <div class="modal dialog" id="modify-user">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                                                <h5 class="modal-title">用户资料</h5>
                                            </div>
                                            <div class="modal-body">
                                                <form class="form-inline">
                                                    <div class="mb12">
                                                        <div class="form-group mr47">
                                                            <label>姓名:</label>
                                                             <input id="userName" type="text" name="name" class="form-control">
                                                        </div>
                                                        <div class="form-group mr47">
                                                            <label>性别:</label>
                                                            <select id="sex" class="form-control" name="gender">
                                                                <option value="">性别</option>
                                                                <option value="男">男</option>
                                                                <option value="女">女</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>帐号:</label>
                                                            <input id="userAccount" type="text" name="account" class="form-control">
                                                        </div>
                                                    </div>
                                                    <div class="mb12">
                                                        <div class="form-group mr47">
                                                            <label>角色设置:</label>
                                                            <select id="roleId" class="form-control">
                                                            </select>
                                                        </div>
                                                        <div class="form-group mr47">
                                                            <label>状态:</label>
                                                            <select id="status"  class="form-control">
                                                                <option value="" >状态</option>
                                                                <option value="1" >启用</option>
                                                                <option value="0">停用</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>密码:</label>
                                                            <input id="password" type="text" value="123456" class="form-control">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>备注:</label>
                                                        <textarea id="memo" class="form-control"></textarea>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button id="saveId" type="button" class="btn-1 btn-define">保存</button>
                                                <button type="button" class="btn-1 btn-cancel" data-dismiss="modal">取消</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table id="table"
										   data-toggle="table" 
								           data-pagination="true">
                                        <thead>
                                            <tr>
                                                <th data-checkbox="true">全选</th>
												<th data-field="id" data-align="center">id</th>
												<th data-field="userName" data-align="center">用户名称</th>
												<th data-field="sex" data-align="center">性别</th>
												<th data-field="userAccount" data-align="center">账号</th>
												<th data-field="status"  data-align="center">状态</th>
												<th data-field="creator" data-align="center">创建人</th>
												<th data-field="createTime" data-align="center">创建日期</th>
												<th data-field="modifier" data-align="center">修改人</th>
												<th data-field="modifyTime" data-align="center">修改日期</th>
												<th data-field="memo" data-align="center">备注</th>
												<th data-formatter="operateFormatter" data-align="center" data-events="operateEvents">操作</th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div ng-include="'../common/warning.html'"></div>
    <script type="text/javascript" src="../js/angular/angular.min.js"></script>
	<script src="../js/jquery/jquery-1.11.1.min.js"></script>
	<script src="../js/jquery/jquery.tips.js"></script>
	<script src="../js/bootstrap/bootstrap.min.js"></script>
	<script src="../js/bootstrap/bootstrap-table.min.js"></script>
	<script src="../js/common/common.js"></script>
	<script type="text/javascript">
	setRole();
	function add(){
    	$("#password").parent("div").show();
    	$("#saveId").off('click').on('click',function(){
    		params=getParameter($(this));
    		if(params!=null){
    			params.password=$("#password").val();
				saveAjax("userManage/addUser",params,$(this))
			}
	    });
    }
    //关闭模态框触发清空
    $('#modify-user').on('hidden.bs.modal', function (e) {
    	  $(this).find(":input").val("");
    	  $("#password").val("123456");
    	})
	var $table = $('#table');
	function operateFormatter(value, row, index) {
        return [
            '<a class="modify" href="javascript:void(0)"  title="编辑">',
            '修改',
            '</a>  ',
            '<a class="resetPas" href="javascript:void(0)"  title="重置密码">',
            '重置密码',
            '</a>  '
        ].join('');
    }
 window.operateEvents = {
	        'click .modify': function (e, value, row, index) {
	        	var options={backdrop:true};
	        	var userId=row.id;
	        	$('#modify-user').modal(options);
	        	$.ajax({ type: "POST",url: baseUrl+"userManage/getUser",data:{"id":userId,"priviledgesID":priviledgesID}, 
	        		//async: false, 
	        		success: function(data){
        			$("#userName").val(data.rows.userName);
        			$("#userAccount").val(data.rows.userAccount);
        			$("#sex").val(data.rows.sex);
        			$("#status").val(data.rows.status);
        			$("#grade").val(data.rows.grade);
        			$("#department").val(data.rows.department);
        			$("#courses").val(data.rows.courses);
        			$("#roleId").val(data.rows.roleId);
        			$("#memo").val(data.rows.memo);
        			$("#password").parent("div").hide();
        		}});
	        	$("#saveId").off('click').on('click',function(){
	        		params=getParameter($(this));
					if(params!=null){
						params.id=userId;
						saveAjax("userManage/modifyUser",params,$(this))
					}
			    });
	        },
	        'click .resetPas': function (e, value, row, index) {
	        	$("#warningMsg").text("你确定要重置["+row.userName+"]密码？");
	        	var options={backdrop:true};
	        	$('#warningConfirm').modal(options);
	        	$("#OKConfirm").off("click").on("click",function(){
	        		$.post(baseUrl+"userManage/resetPassword",{id:row.id,"priviledgesID":priviledgesID},function(data){
	        			if(data.status==0){
	        				$table.bootstrapTable('refresh');
	        			}else{
	        				alert(data.message);
	        			}
	        		})
	        	});
	        }
	    };
	//获取参数
	function getParameter(tip){
		var vuserName=$("#userName").val();
		var vsex=$("#sex").val();
		var vuserAccount=$("#userAccount").val();
		var vstatus=$("#status").val();
		var vroleId=$("#roleId").val();
		var vdepartment=$("#department").val();
		var vgrade=$("#grade").val();
		var vcourses=$("#courses").val();
		var vmemo=$("#memo").val();
		var vlidArr=[vuserName,vsex,vuserAccount,vroleId,vstatus];
		var msgArr1=["名称不能为空","性别不能为空","账号不能为空","用户角色不能为空","状态不能为空"];
		if(isNull(vlidArr,msgArr1,tip)){
			var params={
					userName:vuserName,
					sex:vsex,
					userAccount:vuserAccount,
					status:vstatus,
					roleId:vroleId,
					department:vdepartment,
					grade:vgrade,
					courses:vcourses,
					memo:vmemo
			}
			return params;
		}else{
			return null;
		}
	}
	var searchName,searchAccount,searchStatus;
	function onSearch(){
		searchName=$("#searchName").val();
		searchAccount=$("#searchAccount").val();
		searchStatus=$("#searchStatus").val();
			$table.bootstrapTable('refresh', {
				query: {
				search: searchName,
   				status:searchStatus,
   				account:searchAccount
				}
			});
	}
	$table.bootstrapTable({
		url: baseUrl+'userManage/showQueryUser',
		queryParams:function(params){
			params.search=searchName;
			params.account=searchAccount;
			params.status=searchStatus;
			params.priviledgesID=priviledgesID;
    		return params;
    	}
	});
	</script>
</body>
</html>